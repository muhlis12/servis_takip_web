<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8">
    <title>Servis Takip - Öz Ceylan Turizm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <style>
      :root {
        --oz-primary: #002b5c;
        --oz-dark:    #001330;
        --oz-accent:  #f39c12;
      }

      body {
        background-color: #f4f6fb;
      }

      .navbar-oz {
        background: linear-gradient(90deg, var(--oz-dark), var(--oz-primary));
        box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      }

      .navbar-brand span {
        font-weight: 700;
        letter-spacing: .03em;
      }

      .brand-subtitle {
        font-size: .8rem;
        opacity: .9;
      }

      .oz-header-strip {
        border-top: 3px solid var(--oz-accent);
      }

      .card {
        border-radius: .75rem;
        border: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      }

      .card-header {
        background-color: #ffffff;
        border-bottom: 1px solid #eef1f7;
        font-weight: 600;
      }

      .btn-primary {
        background-color: var(--oz-primary);
        border-color: var(--oz-primary);
      }

      .btn-primary:hover {
        background-color: var(--oz-dark);
        border-color: var(--oz-dark);
      }

      .btn-warning {
        background-color: var(--oz-accent);
        border-color: var(--oz-accent);
        color: #fff;
      }

      .btn-warning:hover {
        filter: brightness(.9);
        color: #fff;
      }

      .table-search-input {
        max-width: 220px;
      }

      /* Kayan yazı şeridi */
      .marquee-strip {
        background-color: var(--oz-dark);
        color: #ffffff;
        overflow: hidden;
        white-space: nowrap;
        font-size: 0.9rem;
      }

      .marquee-text {
        display: inline-block;
        padding: 4px 0;
        animation: marquee 18s linear infinite;
      }

      @keyframes marquee {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
      }
    </style>
  </head>
  <body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-oz">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center"
           href="{{ url_for('index') if session.get('user_id') else url_for('login') }}">
          <img
            src="{{ url_for('static', filename='img/logo.png') }}"
            alt="Öz Ceylan Turizm"
            style="height:38px; width:auto; object-fit:contain; margin-right:.6rem;"
            onerror="this.style.display='none';"
          >
          <div class="d-flex flex-column">
            <span>Öz Ceylan Turizm</span>
            <span class="brand-subtitle">Servis Takip ve Muhasebe Paneli</span>
          </div>
        </a>

        <div class="ms-auto d-flex align-items-center text-white">
          <div class="text-end me-3 d-none d-md-block" style="font-size:.8rem; opacity:.8;">
            <div>Keçiören / Ankara</div>
            <div>Tel: 0 312 360 90 15</div>
          </div>

          {% if session.get('user_id') %}
            <div class="me-3 text-end" style="font-size:.8rem;">
              <div>{{ session.get('full_name') or session.get('username') }}</div>
              <div style="opacity:.7;">Oturum açık</div>
            </div>
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-light">Çıkış</a>
          {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-sm btn-outline-light">Giriş</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- KAYAN YAZI -->
    <div class="marquee-strip">
      <div class="container">
        <div class="marquee-text">
          ÖZ CEYLAN TURİZM • Servis Taşımacılığı • Servis Takip ve Muhasebe Sistemi • Keçiören / Ankara • Güvenli ve Konforlu Öğrenci Servisi
        </div>
      </div>
    </div>

    <div class="oz-header-strip"></div>

    <main class="container my-4">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-3">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Tablo arama fonksiyonu -->
    <script>
      function filterTable(tableId, query) {
        query = (query || '').toLowerCase();
        const table = document.getElementById(tableId);
        if (!table || !table.tBodies.length) return;
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.rows);

        for (const row of rows) {
          // Detay satırları (collapse olanlar) parent satıra bağlı
          if (row.dataset.detail === '1') continue;

          const text = row.innerText.toLowerCase();
          const match = !query || text.indexOf(query) !== -1;

          row.style.display = match ? '' : 'none';

          const detailId = row.dataset.detailId;
          if (detailId) {
            const detailRows = tbody.querySelectorAll(
              "tr[data-detail-for='" + detailId + "']"
            );
            detailRows.forEach(function(dr) {
              dr.style.display = match ? '' : 'none';
            });
          }
        }
      }
    </script>
  </body>
</html>
